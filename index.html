<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>上班动力</title>
  <style>
    :root{
      /* Warm, Notion-friendly palette */
      --bg: #ffffff;
      --card: #ffffff;
      --cardTint: rgba(255, 138, 76, 0.06);
      --border: rgba(15, 23, 42, 0.10); /* slate-ish */
      --text: rgba(15, 23, 42, 0.92);
      --muted: rgba(15, 23, 42, 0.62);
      --muted2: rgba(15, 23, 42, 0.50);

      --warm1: rgba(255, 141, 72, 0.95);  /* orange */
      --warm2: rgba(255, 99, 132, 0.88);  /* rose */
      --warm3: rgba(255, 196, 82, 0.92);  /* amber */
      --shadow: 0 18px 50px rgba(2, 6, 23, 0.12);
      --radius: 20px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
                   "PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;
      color: var(--text);
      background: var(--bg);
      padding: 14px;
      display: grid;
      place-items: center;
    }

    .wrap{
      width: min(760px, 100%);
    }

    .card{
      border-radius: var(--radius);
      background:
        radial-gradient(900px 240px at 10% 0%, rgba(255, 196, 82, .18), transparent 60%),
        radial-gradient(900px 240px at 90% 0%, rgba(255, 99, 132, .14), transparent 60%),
        linear-gradient(180deg, var(--card), var(--card));
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
    }

    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(720px 260px at 20% 0%, rgba(255, 141, 72, .14), transparent 64%),
        radial-gradient(760px 280px at 80% 0%, rgba(255, 99, 132, .10), transparent 66%),
        radial-gradient(800px 320px at 50% 120%, rgba(255, 196, 82, .12), transparent 70%);
      filter: blur(10px);
      opacity: 1;
      pointer-events:none;
    }

    .inner{
      position: relative;
      padding: 18px;
    }

    .top{
      display:flex;
      gap:12px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .title{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight: 800;
      letter-spacing: -0.02em;
      font-size: 16px;
    }

    .dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--warm1), var(--warm2));
      box-shadow: 0 0 16px rgba(255, 141, 72, .24);
    }

    .chips{
      display:flex;
      gap:8px;
      flex-wrap: wrap;
    }

    .chip{
      appearance:none;
      border:1px solid rgba(15, 23, 42, 0.12);
      background: rgba(15, 23, 42, 0.03);
      color: var(--muted);
      padding: 8px 10px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 12px;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      user-select: none;
    }

    .chip:hover{ transform: translateY(-1px); }
    .chip.active{
      color: rgba(15, 23, 42, 0.92);
      border-color: rgba(255, 141, 72, 0.35);
      background: linear-gradient(90deg, rgba(255, 141, 72, .14), rgba(255, 99, 132, .10));
    }

    .big{
      font-size: clamp(34px, 6vw, 54px);
      font-weight: 900;
      letter-spacing: -0.03em;
      line-height: 1.05;
      margin-top: 10px;
      text-shadow: 0 10px 30px rgba(2, 6, 23, .06);
    }

    .sub{
      display:flex;
      gap:10px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 10px;
      color: var(--muted);
      font-size: 13px;
    }

    .pill{
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(15, 23, 42, 0.10);
      background: rgba(15, 23, 42, 0.02);
    }

    .bar{
      margin-top: 14px;
      height: 12px;
      border-radius: 999px;
      overflow: hidden;
      background: rgba(15, 23, 42, 0.06);
      border: 1px solid rgba(15, 23, 42, 0.08);
      position: relative;
    }

    .fill{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--warm1), var(--warm3), var(--warm2));
      box-shadow: 0 0 20px rgba(255, 141, 72, .22);
      transition: width .25s ease;
    }

    .meta{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 14px;
    }

    .box{
      border: 1px solid rgba(15, 23, 42, 0.10);
      background: rgba(255, 255, 255, 0.70);
      border-radius: 16px;
      padding: 12px;
      backdrop-filter: blur(6px);
    }

    .k{ font-size: 12px; color: var(--muted2); }
    .v{ font-size: 14px; margin-top: 6px; color: rgba(15, 23, 42, 0.92); font-weight: 750; }
    .hint{ font-size: 12px; color: var(--muted2); margin-top: 8px; }

    .footer{
      margin-top: 14px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      color: var(--muted2);
      font-size: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(15, 23, 42, 0.08);
    }

    .spark{
      color: rgba(15, 23, 42, 0.92);
      font-weight: 800;
    }

    .mini{
      font-variant-numeric: tabular-nums;
    }

    @media (max-width: 520px){
      .meta{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="inner">
        <div class="top">
          <div class="title">
            <span class="dot"></span>
            <span>上班动力</span>
          </div>
          <div class="chips" role="tablist" aria-label="Range">
            <button class="chip active" data-mode="today" role="tab">今日</button>
            <button class="chip" data-mode="month" role="tab">本月</button>
            <button class="chip" data-mode="year" role="tab">今年</button>
          </div>
        </div>

        <div class="big" id="earned">$0.00</div>

        <div class="sub">
          <span class="pill" id="status">Pacific time</span>
          <span class="pill mini" id="workLine">工作时段：9:00 AM → 10:00 PM</span>
          <span class="pill mini" id="dayType">—</span>
        </div>

        <div class="bar" aria-label="Progress bar">
          <div class="fill" id="fill"></div>
        </div>

        <div class="meta">
          <div class="box">
            <div class="k" id="rateLabel">按工作日平均（日薪）</div>
            <div class="v mini" id="rateValue">—</div>
            <div class="hint" id="rateHint">按周一到周五，并排除美国联邦法定节假日（observed）。</div>
          </div>
          <div class="box">
            <div class="k">时段内已工作</div>
            <div class="v mini" id="timeValue">—</div>
            <div class="hint mini" id="timeHint">—</div>
          </div>
        </div>

        <div class="footer">
          <div class="mini" id="motivation">—</div>
          <div class="mini" id="clock">—</div>
        </div>
      </div>
    </div>
  </div>

<script>
/**
 * CONFIG (your values)
 */
const CONFIG = {
  annualSalaryUSD: 112000,
  timeZone: "America/Los_Angeles",
  currency: "USD",
  workStartHM: "09:00", // 9AM
  workEndHM:   "22:00", // 10PM
  excludeUSFederalHolidays: true
};

const $ = (id) => document.getElementById(id);

let MODE = "today";

/**
 * Time helpers (TZ-safe)
 */
function nowPartsInTZ(tz){
  const dtf = new Intl.DateTimeFormat("en-US", {
    timeZone: tz, year:"numeric", month:"2-digit", day:"2-digit",
    hour:"2-digit", minute:"2-digit", second:"2-digit", hour12:false
  });
  const parts = dtf.formatToParts(new Date());
  const get = (type) => Number(parts.find(p => p.type === type).value);
  return { year:get("year"), month:get("month"), day:get("day"), hour:get("hour"), minute:get("minute"), second:get("second") };
}

function dateKey(y,m,d){ return `${y}-${String(m).padStart(2,"0")}-${String(d).padStart(2,"0")}`; }
function dayOfWeek(y,m,d){ return new Date(Date.UTC(y, m-1, d)).getUTCDay(); } // 0 Sun..6 Sat
function isWeekday(y,m,d){ const dow = dayOfWeek(y,m,d); return dow>=1 && dow<=5; }

function parseHM(s){
  const m = /^(\d{2}):(\d{2})$/.exec((s||"").trim());
  if(!m) return null;
  const hh = Number(m[1]), mm = Number(m[2]);
  if(hh<0||hh>23||mm<0||mm>59) return null;
  return hh*60+mm;
}
function clamp(x,a,b){ return Math.max(a, Math.min(b, x)); }

/**
 * US Federal holidays (observed)
 */
function nthWeekdayOfMonth(year, month1to12, weekday0Sun, n){
  let count = 0;
  for(let d=1; d<=31; d++){
    const dt = new Date(Date.UTC(year, month1to12-1, d));
    if(dt.getUTCMonth() !== month1to12-1) break;
    if(dt.getUTCDay() === weekday0Sun){
      count++;
      if(count === n) return {y:year, m:month1to12, d};
    }
  }
  return null;
}
function lastWeekdayOfMonth(year, month1to12, weekday0Sun){
  let last = null;
  for(let d=1; d<=31; d++){
    const dt = new Date(Date.UTC(year, month1to12-1, d));
    if(dt.getUTCMonth() !== month1to12-1) break;
    if(dt.getUTCDay() === weekday0Sun) last = {y:year, m:month1to12, d};
  }
  return last;
}
function observedIfWeekend(y,m,d){
  const dow = dayOfWeek(y,m,d);
  if(dow === 6){ // Sat -> Fri
    const prev = new Date(Date.UTC(y, m-1, d-1));
    return {y: prev.getUTCFullYear(), m: prev.getUTCMonth()+1, d: prev.getUTCDate()};
  }
  if(dow === 0){ // Sun -> Mon
    const next = new Date(Date.UTC(y, m-1, d+1));
    return {y: next.getUTCFullYear(), m: next.getUTCMonth()+1, d: next.getUTCDate()};
  }
  return {y,m,d};
}
function usFederalObservedHolidaysSet(year){
  const holidays = [];
  holidays.push(observedIfWeekend(year, 1, 1));   // New Year’s
  holidays.push(observedIfWeekend(year, 6, 19));  // Juneteenth
  holidays.push(observedIfWeekend(year, 7, 4));   // Independence
  holidays.push(observedIfWeekend(year, 11, 11)); // Veterans
  holidays.push(observedIfWeekend(year, 12, 25)); // Christmas

  holidays.push(nthWeekdayOfMonth(year, 1, 1, 3));  // MLK: 3rd Mon Jan
  holidays.push(nthWeekdayOfMonth(year, 2, 1, 3));  // Washington: 3rd Mon Feb
  holidays.push(lastWeekdayOfMonth(year, 5, 1));    // Memorial: last Mon May
  holidays.push(nthWeekdayOfMonth(year, 9, 1, 1));  // Labor: 1st Mon Sep
  holidays.push(nthWeekdayOfMonth(year, 10, 1, 2)); // Columbus/Indigenous: 2nd Mon Oct
  holidays.push(nthWeekdayOfMonth(year, 11, 4, 4)); // Thanksgiving: 4th Thu Nov

  const set = new Set();
  for(const h of holidays){
    if(!h) continue;
    set.add(dateKey(h.y,h.m,h.d));
  }
  return set;
}
function isWorkday(y,m,d, holidaySet){
  if(!isWeekday(y,m,d)) return false;
  if(CONFIG.excludeUSFederalHolidays && holidaySet.has(dateKey(y,m,d))) return false;
  return true;
}

/**
 * Count workdays in year
 */
function countWorkdaysInYear(year){
  const holidaySet = usFederalObservedHolidaysSet(year);
  let count = 0;
  for(let m=1; m<=12; m++){
    for(let d=1; d<=31; d++){
      const dt = new Date(Date.UTC(year, m-1, d));
      if(dt.getUTCMonth() !== m-1) break;
      if(isWorkday(year,m,d, holidaySet)) count++;
    }
  }
  return { count, holidaySet };
}

function formatMoney(x){
  return x.toLocaleString(undefined, { style:"currency", currency: CONFIG.currency });
}

function minutesWorkedInWindow(nowMins, startMins, endMins){
  const shift = endMins - startMins;
  const worked = clamp(nowMins - startMins, 0, shift);
  return { worked, shift };
}

function sumEarnedForRange(rangeStartYMD, rangeEndYMD, nowP, startMins, endMins, dailyPay, holidaySet){
  let total = 0;
  let workdaysCounted = 0;
  let workedMinsToday = 0;
  let shiftMins = endMins - startMins;

  const start = new Date(Date.UTC(rangeStartYMD.y, rangeStartYMD.m-1, rangeStartYMD.d));
  const end   = new Date(Date.UTC(rangeEndYMD.y,   rangeEndYMD.m-1,   rangeEndYMD.d));

  for(let dt = start; dt <= end; dt = new Date(dt.getTime() + 86400000)){
    const y = dt.getUTCFullYear(), m = dt.getUTCMonth()+1, d = dt.getUTCDate();
    if(!isWorkday(y,m,d, holidaySet)) continue;

    workdaysCounted++;
    const isToday = (y===nowP.year && m===nowP.month && d===nowP.day);

    if(isToday){
      const nowMins = nowP.hour*60 + nowP.minute + nowP.second/60;
      const { worked, shift } = minutesWorkedInWindow(nowMins, startMins, endMins);
      workedMinsToday = worked;
      shiftMins = shift;
      total += dailyPay * (worked / shift);
    } else {
      total += dailyPay;
    }
  }

  return { total, workdaysCounted, workedMinsToday, shiftMins };
}

function ymdStartOfMonth(y,m){ return {y, m, d:1}; }
function ymdStartOfYear(y){ return {y, m:1, d:1}; }

/**
 * Quote: refresh at most once per hour
 */
const QUOTES = [
  "今天也要稳稳推进。",
  "专注一小时，胜过焦虑一整天。",
  "小步快跑，持续就会有回报。",
  "别等状态，先开始就赢了。",
  "把当下做好，未来自然会更好。",
  "努力不是内耗，是在积累选择权。",
  "你在变强，只是你还没察觉。",
  "先完成，再完美。",
  "今天的坚持，是明天的底气。",
  "上班不止上班，是在升级自己。"
];

let lastQuoteHourKey = null;
let currentQuote = QUOTES[0];

function pickHourlyQuote(nowP){
  const hourKey = `${nowP.year}-${nowP.month}-${nowP.day}-${nowP.hour}`;
  if(hourKey === lastQuoteHourKey) return currentQuote;

  // deterministic-ish index so it changes each hour but is stable within the hour
  const seed = (nowP.year*1000000 + nowP.month*10000 + nowP.day*100 + nowP.hour);
  const idx = Math.abs(seed) % QUOTES.length;

  lastQuoteHourKey = hourKey;
  currentQuote = QUOTES[idx];
  return currentQuote;
}

function tick(){
  const nowP = nowPartsInTZ(CONFIG.timeZone);

  const startMins = parseHM(CONFIG.workStartHM);
  const endMins   = parseHM(CONFIG.workEndHM);
  if(startMins === null || endMins === null || endMins <= startMins){
    $("earned").textContent = "Fix time window";
    return;
  }

  const { count: workdaysInYear, holidaySet } = countWorkdaysInYear(nowP.year);
  const dailyPay = CONFIG.annualSalaryUSD / workdaysInYear;

  const todayIsWorkday = isWorkday(nowP.year, nowP.month, nowP.day, holidaySet);
  const nowMins = nowP.hour*60 + nowP.minute + nowP.second/60;
  const { worked: workedTodayMins, shift: shiftMins } = minutesWorkedInWindow(nowMins, startMins, endMins);

  const todayEarned = todayIsWorkday ? (dailyPay * (workedTodayMins / shiftMins)) : 0;
  const todayPct = todayIsWorkday ? (workedTodayMins / shiftMins) : 0;

  const monthStart = ymdStartOfMonth(nowP.year, nowP.month);
  const yearStart  = ymdStartOfYear(nowP.year);
  const todayYMD   = { y: nowP.year, m: nowP.month, d: nowP.day };

  const monthAgg = sumEarnedForRange(monthStart, todayYMD, nowP, startMins, endMins, dailyPay, holidaySet);
  const yearAgg  = sumEarnedForRange(yearStart,  todayYMD, nowP, startMins, endMins, dailyPay, holidaySet);

  let earned = 0;
  let pct = 0;
  let status = "";
  let timeValue = "";
  let timeHint = "";
  let dayType = todayIsWorkday ? "工作日 ✅" : "非工作日（不计入平均薪资）";

  if(MODE === "today"){
    earned = todayEarned;
    pct = todayPct;
    status = "今日进度";
    timeValue = todayIsWorkday ? `${Math.floor(workedTodayMins/60)}h ${Math.floor(workedTodayMins%60)}m` : "0h 0m";
    timeHint = todayIsWorkday
      ? `今天还可累计：${formatMoney(dailyPay - todayEarned)}`
      : "休息也是生产力 ✨";
  } else if(MODE === "month"){
    earned = monthAgg.total;

    // month progress by workdays elapsed / workdays total in month
    const monthWorkdaysTotal = (() => {
      let c=0;
      for(let d=1; d<=31; d++){
        const dt = new Date(Date.UTC(nowP.year, nowP.month-1, d));
        if(dt.getUTCMonth() !== nowP.month-1) break;
        if(isWorkday(nowP.year, nowP.month, d, holidaySet)) c++;
      }
      return c;
    })();

    pct = monthWorkdaysTotal ? (monthAgg.workdaysCounted / monthWorkdaysTotal) : 0;
    status = "本月累计";
    timeValue = `已过 ${monthAgg.workdaysCounted} 个工作日`;
    const remainingWorkdays = Math.max(0, monthWorkdaysTotal - monthAgg.workdaysCounted);
    timeHint = `本月预计还剩 ~${remainingWorkdays} 个工作日`;
  } else { // year
    earned = yearAgg.total;
    pct = workdaysInYear ? (yearAgg.workdaysCounted / workdaysInYear) : 0;
    status = "今年累计";
    timeValue = `${yearAgg.workdaysCounted} / ${workdaysInYear} 个工作日`;
    timeHint = `年薪：${formatMoney(CONFIG.annualSalaryUSD)} • 日均：${formatMoney(dailyPay)}`;
  }

  $("earned").textContent = formatMoney(earned);
  $("fill").style.width = `${(pct*100).toFixed(1)}%`;
  $("status").textContent = `${status}（PT）`;
  $("dayType").textContent = dayType;

  $("rateValue").textContent =
    `${formatMoney(dailyPay)} / 工作日  •  ${formatMoney(dailyPay/(shiftMins/60))}/小时（时段内）`;

  $("timeValue").textContent = timeValue;
  $("timeHint").textContent = timeHint;

  // Quote refresh: once per hour max
  const quote = pickHourlyQuote(nowP);

  // a little extra “+ per min” for Today
  let extra = "";
  if(MODE === "today" && todayIsWorkday){
    const dollarsPerMinute = dailyPay / shiftMins;
    extra = ` • +${formatMoney(dollarsPerMinute)}/分钟`;
  } else if(MODE === "month"){
    extra = ` • 日均：${formatMoney(dailyPay)}`;
  } else if(MODE === "year"){
    extra = ` • 工作日/年：${workdaysInYear}`;
  }

  $("motivation").innerHTML = `<span class="spark">✦</span> ${quote}${extra}`;

  const hh = String(((nowP.hour + 11) % 12) + 1).padStart(2,"0");
  const ampm = nowP.hour >= 12 ? "PM" : "AM";
  const mm = String(nowP.minute).padStart(2,"0");
  const ss = String(nowP.second).padStart(2,"0");
  $("clock").textContent = `${hh}:${mm}:${ss} ${ampm} PT`;
}

function setMode(mode){
  MODE = mode;
  document.querySelectorAll(".chip").forEach(b => b.classList.toggle("active", b.dataset.mode === mode));
  tick();
}

document.querySelectorAll(".chip").forEach(btn => {
  btn.addEventListener("click", () => setMode(btn.dataset.mode));
});

tick();
setInterval(tick, 250);
</script>
</body>
</html>
