<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Income Accumulator</title>
  <style>
    body { font-family: ui-sans-serif, system-ui; margin: 0; padding: 16px; }
    .card { border: 1px solid #e5e7eb; border-radius: 16px; padding: 16px; }
    .big { font-size: 36px; font-weight: 700; letter-spacing: -0.02em; }
    .row { display:flex; gap:12px; align-items: baseline; flex-wrap: wrap; color:#374151; }
    .bar { height: 10px; background:#f3f4f6; border-radius:999px; overflow:hidden; margin-top: 12px; }
    .fill { height: 100%; width: 0%; background:#111827; }
    .small { font-size: 12px; color:#6b7280; margin-top: 8px; }
    input { width: 100%; box-sizing: border-box; margin-top: 10px; padding: 8px; border-radius: 10px; border:1px solid #e5e7eb; }
  </style>
</head>
<body>
  <div class="card">
    <div class="big" id="earned">$0.00</div>
    <div class="row">
      <div id="status">Today</div>
      <div>•</div>
      <div id="rateLine">$0.00 / hour</div>
      <div>•</div>
      <div id="timeLine">0h 0m worked</div>
    </div>
    <div class="bar"><div class="fill" id="fill"></div></div>
    <div class="small">Edit settings below (stored locally in your browser).</div>

    <label class="small">Hourly rate (USD)</label>
    <input id="rate" type="number" step="0.01" />

    <label class="small">Work start (HH:MM, 24h)</label>
    <input id="start" placeholder="09:00" />

    <label class="small">Work end (HH:MM, 24h)</label>
    <input id="end" placeholder="17:00" />
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  function load() {
    $("rate").value = localStorage.getItem("rate") ?? "50";
    $("start").value = localStorage.getItem("start") ?? "09:00";
    $("end").value = localStorage.getItem("end") ?? "17:00";
  }

  function save() {
    localStorage.setItem("rate", $("rate").value);
    localStorage.setItem("start", $("start").value);
    localStorage.setItem("end", $("end").value);
  }

  function parseHM(s) {
    const m = /^(\d{2}):(\d{2})$/.exec((s || "").trim());
    if (!m) return null;
    const hh = Number(m[1]), mm = Number(m[2]);
    if (hh < 0 || hh > 23 || mm < 0 || mm > 59) return null;
    return hh * 60 + mm;
  }

  function clamp(x, a, b) { return Math.max(a, Math.min(b, x)); }

  function tick() {
    const rate = Number($("rate").value || 0); // $/hour
    const startM = parseHM($("start").value);
    const endM = parseHM($("end").value);

    if (!rate || startM === null || endM === null || endM <= startM) {
      $("earned").textContent = "Fix settings";
      $("rateLine").textContent = "";
      $("timeLine").textContent = "";
      $("fill").style.width = "0%";
      return;
    }

    const now = new Date();
    const nowM = now.getHours() * 60 + now.getMinutes() + now.getSeconds()/60;

    const shift = endM - startM;
    const worked = clamp(nowM - startM, 0, shift);

    const earned = (worked / 60) * rate;
    const pct = (worked / shift) * 100;

    $("earned").textContent = earned.toLocaleString(undefined, { style: "currency", currency: "USD" });
    $("rateLine").textContent = `${rate.toLocaleString(undefined,{maximumFractionDigits:2})} / hour`;
    const h = Math.floor(worked / 60);
    const m = Math.floor(worked % 60);
    $("timeLine").textContent = `${h}h ${m}m worked`;
    $("fill").style.width = `${pct.toFixed(1)}%`;
  }

  ["rate","start","end"].forEach(id => $(id).addEventListener("input", () => { save(); tick(); }));
  load(); tick();
  setInterval(tick, 250); // smooth-ish
</script>
</body>
</html>
